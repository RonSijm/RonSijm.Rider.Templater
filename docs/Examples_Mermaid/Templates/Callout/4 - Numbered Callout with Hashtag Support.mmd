flowchart TD
%% 4 - Numbered Callout with Hashtag Support

%% Node styles
classDef startEnd fill:#9f9,stroke:#333,stroke-width:2px
classDef condition fill:#ffd700,stroke:#333,stroke-width:2px
classDef loop fill:#87ceeb,stroke:#333,stroke-width:2px
classDef loopEnd fill:#b0e0e6,stroke:#333,stroke-width:1px
classDef interpolation fill:#98fb98,stroke:#333,stroke-width:1px
classDef execution fill:#bbf,stroke:#333,stroke-width:1px
classDef funcDecl fill:#dda0dd,stroke:#333,stroke-width:1px
classDef funcCall fill:#ff9,stroke:#333,stroke-width:1px
classDef variable fill:#fbf,stroke:#333,stroke-width:1px
classDef returnNode fill:#ffa07a,stroke:#333,stroke-width:1px
classDef fork fill:#ff6b6b,stroke:#333,stroke-width:2px
classDef join fill:#4ecdc4,stroke:#333,stroke-width:2px
classDef error fill:#f66,stroke:#333,stroke-width:2px

n0(["Start"])
class n0 startEnd
n1["const callouts = { //  Callout name  ..."]
class n1 variable
n2["const typeNames = []"]
class n2 variable
n3["const typeLabels = []"]
class n3 variable
n4["// Push all keys into `typeNames`"]
class n4 execution
n5["// Push all values into `typeLabels`"]
class n5 execution
n6["// Only values before the 1st instanc..."]
class n6 execution
n7["Object.keys(callouts).forEach((key, i..."]
class n7 funcCall
n8["// User chooses from list comprised o..."]
class n8 execution
n9["let calloutType = await tp.system.sug..."]
class n9 variable
n10["// Stop here when the prompt was canc..."]
class n10 funcCall
n11{"if (if (!calloutType))"}
class n11 condition
n12["endif"]
class n12 execution
n13["return"]
class n13 execution
n14["// Get Hashtags found in `callouts` a..."]
class n14 execution
n15["let hashTags = callouts[calloutType]"]
class n15 variable
n16[".match(/#[A-Za-z0-9\-]+/g)?.join(' ')"]
class n16 funcCall
n17[".trim() || ''"]
class n17 funcCall
n18["// Ask user for callout title"]
class n18 execution
n19["let title = await tp.system.prompt('C..."]
class n19 variable
n20[["fork (3 parallel)"]]
class n20 fork
n21[["join"]]
class n21 join
n22["calloutType"]
class n22 interpolation
n23["title"]
class n23 interpolation
n24["hashTags"]
class n24 interpolation
n25["tp.file.cursor()"]
class n25 funcCall
n26(["End"])
class n26 startEnd

%% Control flow
n0 --> n1
n1 --> n2
n2 --> n3
n3 --> n4
n4 --> n5
n5 --> n6
n6 --> n7
n7 --> n8
n8 --> n9
n9 --> n10
n10 --> n11
n11 -->|yes| n13
n13 --> n12
n11 -->|no| n12
n12 --> n14
n14 --> n15
n15 --> n16
n16 --> n17
n17 --> n18
n18 --> n19
n19 --> n20
n20 ==> n22
n22 --> n21
n20 ==> n23
n23 --> n21
n20 ==> n24
n24 --> n21
n21 --> n25
n25 --> n26

%% ========================================
%% PARALLEL EXECUTION ANALYSIS
%% ========================================
%%
%% Parallel Group 1 (n20):
%% All 3 blocks only read variables (no writes) - safe to run in parallel. Variables read: calloutType, title, hashTags. No blocks write to template output (tR) - order doesn't matter
%%
%% Blocks in this group:
%%   - calloutType
%%     reads: calloutType
%%   - title
%%     reads: title
%%   - hashTags
%%     reads: hashTags
